<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>热力图</title>
  <link rel="stylesheet" href="../libs/layui/css/layui.css">
  <link rel="stylesheet" href="../libs/leaflet/leaflet.css"/>
  <link rel="stylesheet" href="../css/style.css">
  <script src="../libs/jquery-3.4.1.min.js"></script>
  <script src="../libs/layui/layui.all.js"></script>
  <script src="../libs/leaflet/leaflet-src.js"></script>
  <script src="../libs/supermap/iclient-leaflet.js"></script>
  <script src="../t-gis/tmap.js"></script>
</head>
<body>
<div id="map" style=";width:100%;height:100%"></div>
<div class="layui-card ctr-panel" style="width: 250px;min-height: 120px">
  速度：
  <div id="speed" style="height: 20px;width: 150px;margin: 10px"></div>
  密度：
  <div id="density" style="height: 20px;width: 150px;margin: 10px"></div>
  拖尾：
  <div id="tailLength" style="height: 20px;width: 150px;margin: 10px"></div>
  宽度：
  <div id="windWidth" style="height: 20px;width: 150px;margin: 10px"></div>
</div>
<script>
  T.createMap('map',);
  T.map.setView([35, 114], 7);
  T.map.addControl(T.controls.pointer());
  let supermapLayer = T.cusTileLayer("https://iserver.supermap.io/iserver/services/map-china400/rest/maps/ChinaDark", {
    maxZoom: 18,
    minZoom: 0
  }, false);
  T.map.addLayer(supermapLayer);
  T.map.setView([0, 0], 2);
  let flowField = new T.vis.FlowField();
  $.getJSON("../asset/wind.json", function (data) {
    setTimeout(function () {
      flowField.setOptions({
        map: T.map,
        data: data
      })
      flowField.start(T.map.getBounds())
    }, 100)
  });
  layui.slider.render({
    elem: '#speed',
    min: 1,
    max: 100,
    value: flowField.getSpeed(),
    change: function (value) {
      flowField.setSpeed(value);
    }
  });
  layui.slider.render({
    elem: '#density',
    min: 100,
    max: 500,
    value: 1 / flowField.getDensity(),
    change: function (value) {
      flowField.stop()
      flowField.setDensity(value);
      flowField.start(T.map.getBounds())
    }
  });
  layui.slider.render({
    elem: '#tailLength',
    min: 5,
    max: 10,
    value: Math.floor(flowField.getWindTail() * 10),
    change: function (value) {
      flowField.setWindTail(value / 10);
    }
  });
  layui.slider.render({
    elem: '#windWidth',
    min: 1,
    max: 10,
    value: flowField.getWidth(),
    change: function (value) {
      flowField.setWidth(value);
    }
  });
</script>
</body>
</html>
